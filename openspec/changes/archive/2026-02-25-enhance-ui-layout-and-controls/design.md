## Context

å½“å‰ HVAC ç³»ç»Ÿçš„å‰ç«¯ç•Œé¢ä½¿ç”¨ React + Vite æž„å»ºï¼Œé€šè¿‡ Modbus åè®®ä¸ŽåŽç«¯é€šä¿¡ã€‚çŽ°æœ‰é¡µé¢åªæœ‰ä¸€ä¸ª `RegistersPanel` ç»„ä»¶å±•ç¤ºæ‰€æœ‰å¯„å­˜å™¨æ•°æ®ï¼Œç¼ºä¹åˆ†åŒºå¸ƒå±€å’Œäº¤äº’è®¾è®¡ã€‚åŽç«¯å·²æä¾›æˆ¿é—´æŽ§åˆ¶ã€ç³»ç»ŸæŽ§åˆ¶ã€çŽ¯å¢ƒç›‘æµ‹ç­‰ APIï¼Œä½†å‰ç«¯æœªå……åˆ†åˆ©ç”¨ã€‚

**æŠ€æœ¯æ ˆï¼š**
- å‰ç«¯ï¼šReact 19.2 + Vite 7.3 + Axios
- åŽç«¯ï¼šFastAPI + pymodbus
- å¯„å­˜å™¨åˆ†ç»„ï¼šenvironment, system, york, living_room, master_bedroom, second_bedroom, study_room, kitchen, fresh_air

## Goals / Non-Goals

**Goals:**
- é‡æž„å‰ç«¯å¸ƒå±€ä¸ºä¸‰å¤§åŠŸèƒ½åŒºï¼šç³»ç»Ÿæ¦‚è§ˆã€æˆ¿é—´ä¿¡æ¯ã€æ–°é£Žç³»ç»Ÿ
- è§†è§‰ä¸ŠåŒºåˆ†åªè¯»å±•ç¤ºå’Œå¯æŽ§åˆ¶æ“ä½œï¼ˆä½¿ç”¨ä¸åŒé¢œè‰²ã€å›¾æ ‡ã€ç¦ç”¨çŠ¶æ€ï¼‰
- å¢žå¼ºç”¨æˆ·äº¤äº’ä½“éªŒï¼ˆåŠ è½½çŠ¶æ€ã€æ“ä½œåé¦ˆã€é”™è¯¯æç¤ºï¼‰
- æ”¯æŒå“åº”å¼å¸ƒå±€ï¼Œé€‚é…ä¸åŒå±å¹•å°ºå¯¸
- æ‰©å±•æˆ¿é—´æŽ§åˆ¶åŠŸèƒ½ï¼ˆè¿è¡Œæ¨¡å¼ã€é£Žé€Ÿè°ƒèŠ‚ï¼‰

**Non-Goals:**
- ä¸ä¿®æ”¹åŽç«¯ Modbus é€šä¿¡é€»è¾‘
- ä¸å¢žåŠ ç”¨æˆ·è®¤è¯å’Œæƒé™ç®¡ç†
- ä¸æ”¯æŒåŽ†å²æ•°æ®æŸ¥è¯¢å’Œå›¾è¡¨å±•ç¤º
- ä¸å®žçŽ°ç§»åŠ¨ç«¯åŽŸç”Ÿ App

## Decisions

### 1. ç»„ä»¶æž¶æž„è®¾è®¡

**å†³ç­–ï¼š** é‡‡ç”¨ç»„ä»¶åŒ–åˆ†å±‚æž¶æž„ï¼ŒæŒ‰åŠŸèƒ½åŒºåŸŸæ‹†åˆ†ç»„ä»¶

**ç†ç”±ï¼š**
- **å¯ç»´æŠ¤æ€§ï¼š** æ¯ä¸ªåŠŸèƒ½åŒºåŸŸç‹¬ç«‹ç»„ä»¶ï¼Œé™ä½Žè€¦åˆåº¦
- **å¯å¤ç”¨æ€§ï¼š** é€šç”¨ UI ç»„ä»¶ï¼ˆå¦‚ DataDisplayã€ControlButtonï¼‰å¯è·¨åŒºåŸŸå¤ç”¨
- **å¯æµ‹è¯•æ€§ï¼š** å°ç²’åº¦ç»„ä»¶ä¾¿äºŽå•å…ƒæµ‹è¯•

**ç»„ä»¶å±‚æ¬¡ï¼š**
```
App.jsx (ä¸»å¸ƒå±€)
â”œâ”€â”€ SystemOverview.jsx (ç³»ç»Ÿæ¦‚è§ˆåŒº)
â”‚   â”œâ”€â”€ EnvironmentMonitoring.jsx (çŽ¯å¢ƒç›‘æµ‹ - åªè¯»)
â”‚   â”œâ”€â”€ SystemControl.jsx (ç³»ç»ŸæŽ§åˆ¶ - å¯æ“ä½œ)
â”‚   â””â”€â”€ YorkHost.jsx (çº¦å…‹ä¸»æœº - åªè¯»)
â”œâ”€â”€ RoomSection.jsx (æˆ¿é—´ä¿¡æ¯åŒº)
â”‚   â”œâ”€â”€ RoomControlPanel.jsx (æˆ¿é—´æŽ§åˆ¶ - å¯æ“ä½œ)
â”‚   â””â”€â”€ KitchenControl.jsx (åŽ¨å«æŽ§åˆ¶ - å¯æ“ä½œ)
â””â”€â”€ FreshAirSection.jsx (æ–°é£Žç³»ç»ŸåŒº - å¯æ“ä½œ)
```

**å¤‡é€‰æ–¹æ¡ˆï¼š** ä½¿ç”¨å•é¡µåº”ç”¨è·¯ç”±åˆ†é¡µ
- **ç¼ºç‚¹ï¼š** å¤±åŽ»å…¨å±€æ¦‚è§ˆèƒ½åŠ›ï¼Œéœ€è¦åˆ‡æ¢é¡µé¢æŸ¥çœ‹ä¸åŒåŒºåŸŸ

### 2. åªè¯»/å¯å†™çŠ¶æ€çš„è§†è§‰åŒºåˆ†

**å†³ç­–ï¼š** ä½¿ç”¨ CSS å˜é‡å’Œ modifier ç±»ååŒºåˆ†åªè¯»å’Œå¯æŽ§åˆ¶åŒºåŸŸ

**è§†è§‰è®¾è®¡è§„åˆ™ï¼š**
| ç±»åž‹ | èƒŒæ™¯è‰² | è¾¹æ¡† | å›¾æ ‡ | äº¤äº’ |
|------|--------|------|------|------|
| åªè¯»å±•ç¤º | `#f5f5f5` | æ— è¾¹æ¡† | ðŸ“Š | ä¸å¯ç‚¹å‡» |
| å¯æŽ§åˆ¶ | `#ffffff` | `1px solid #ddd` | âš™ï¸ | å¯ç‚¹å‡»ã€hover æ•ˆæžœ |

**å®žçŽ°æ–¹å¼ï¼š**
```css
.data-card--readonly {
  background: var(--bg-readonly);
  cursor: default;
}

.data-card--editable {
  background: var(--bg-editable);
  border: 1px solid var(--border-color);
  cursor: pointer;
  transition: all 0.2s;
}

.data-card--editable:hover {
  box-shadow: 0 2px 8px rgba(0,0,0,0.1);
}
```

### 3. çŠ¶æ€ç®¡ç†ç­–ç•¥

**å†³ç­–ï¼š** ä½¿ç”¨ React Hooks + Context API ç®¡ç†å…¨å±€çŠ¶æ€

**ç†ç”±ï¼š**
- **è½»é‡çº§ï¼š** æ— éœ€å¼•å…¥ Redux/Zustandï¼Œé¡¹ç›®è§„æ¨¡è¾ƒå°
- **React å†…ç½®ï¼š** æ— é¢å¤–ä¾èµ–
- **è¶³å¤Ÿåº”å¯¹ï¼š** çŠ¶æ€ä¸»è¦æ˜¯æœåŠ¡å™¨æ•°æ®ï¼Œé€šè¿‡è½®è¯¢æ›´æ–°

**çŠ¶æ€ç»“æž„ï¼š**
```javascript
{
  connection: { status, lastUpdate },
  environment: { pm25, co2, temp, humidity },
  system: { power, homeMode, runMode, fanSpeed },
  york: { supplyTemp, returnTemp },
  rooms: { living_room: {...}, ... },
  freshAir: { status, compressorFreq, ... }
}
```

**å¤‡é€‰æ–¹æ¡ˆï¼š** æ¯ä¸ªç»„ä»¶ç‹¬ç«‹ç®¡ç†çŠ¶æ€
- **ç¼ºç‚¹ï¼š** é‡å¤çš„è½®è¯¢è¯·æ±‚ï¼Œæ•°æ®ä¸ä¸€è‡´é—®é¢˜

### 4. æŽ§åˆ¶æ“ä½œçš„äº¤äº’è®¾è®¡

**å†³ç­–ï¼š** ä½¿ç”¨ Modal/Inline ç¼–è¾‘ç»“åˆæ–¹å¼

**äº¤äº’æ¨¡å¼ï¼š**
- **æ¸©åº¦è®¾å®šï¼š** Inline ç¼–è¾‘ï¼ˆç‚¹å‡»æ˜¾ç¤ºè¾“å…¥æ¡† + ç¡®è®¤/å–æ¶ˆæŒ‰é’®ï¼‰
- **å¼€å…³æŽ§åˆ¶ï¼š** Toggle å¼€å…³ï¼ˆç«‹å³ç”Ÿæ•ˆï¼‰
- **æ¨¡å¼é€‰æ‹©ï¼š** Dropdown ä¸‹æ‹‰é€‰æ‹©ï¼ˆç«‹å³ç”Ÿæ•ˆï¼‰
- **å¤æ‚æ“ä½œï¼š** Modal å¼¹çª—ç¡®è®¤

**ç†ç”±ï¼š**
- **æ•ˆçŽ‡ï¼š** ç®€å•æ“ä½œï¼ˆå¦‚æ¸©åº¦è°ƒèŠ‚ï¼‰æ— éœ€å¼¹çª—
- **å®‰å…¨ï¼š** é‡è¦æ“ä½œï¼ˆå¦‚ç³»ç»Ÿç”µæºï¼‰éœ€è¦ç¡®è®¤
- **ä¸€è‡´æ€§ï¼š** ç¬¦åˆç”¨æˆ·å¸¸è§çš„äº¤äº’ä¹ æƒ¯

### 5. API æ‰©å±•ç­–ç•¥

**å†³ç­–ï¼š** åŽç«¯ API ä¿æŒå½“å‰ç»“æž„ï¼Œå‰ç«¯é€šè¿‡ç»„åˆè°ƒç”¨å®žçŽ°æ–°åŠŸèƒ½

**çŽ°æœ‰å¯ç”¨ APIï¼š**
- `GET /api/environment` - çŽ¯å¢ƒç›‘æµ‹æ•°æ®
- `GET /api/system`, `PUT /api/system` - ç³»ç»ŸæŽ§åˆ¶
- `GET /api/rooms`, `PUT /api/rooms/{room_id}` - æˆ¿é—´æŽ§åˆ¶
- `GET /api/registers/grouped` - æŒ‰åˆ†ç»„èŽ·å–å¯„å­˜å™¨

**å‰ç«¯æ‰©å±•æ–¹å¼ï¼š**
- æ–°é£ŽæŽ§åˆ¶ï¼šä½¿ç”¨ `PUT /api/registers/write` ç›´æŽ¥å†™å…¥æ–°é£Žç›¸å…³å¯„å­˜å™¨ï¼ˆ1047, 1168 ç­‰ï¼‰
- åŽ¨å«æŽ§åˆ¶ï¼šå†™å…¥å¯„å­˜å™¨ 1133ï¼ˆåŽ¨å«è¾å°„å¼€å…³ï¼‰
- è¿è¡Œæ¨¡å¼ï¼šé€šè¿‡ `PUT /api/system` çš„ `run_mode` å‚æ•°æŽ§åˆ¶

**å¤‡é€‰æ–¹æ¡ˆï¼š** æ–°å¢žä¸“ç”¨ APIï¼ˆå¦‚ `/api/fresh-air`, `/api/kitchen`ï¼‰
- **ä¼˜ç‚¹ï¼š** æ›´è¯­ä¹‰åŒ–ï¼Œå°è£…ä¸šåŠ¡é€»è¾‘
- **ç¼ºç‚¹ï¼š** éœ€è¦ä¿®æ”¹åŽç«¯ï¼Œå¢žåŠ å¼€å‘é‡

## Risks / Trade-offs

### é£Žé™© 1: å¯„å­˜å™¨ç›´æŽ¥å†™å…¥çš„å®‰å…¨æ€§
**é£Žé™©ï¼š** ä½¿ç”¨ `PUT /api/registers/write` ç›´æŽ¥æ“ä½œå¯„å­˜å™¨å¯èƒ½å¯¼è‡´è¯¯æ“ä½œ
**ç¼“è§£æŽªæ–½ï¼š**
- å‰ç«¯å¢žåŠ è¾“å…¥éªŒè¯ï¼ˆæ•°å€¼èŒƒå›´æ£€æŸ¥ï¼‰
- é‡è¦æ“ä½œå¢žåŠ ç¡®è®¤å¼¹çª—
- åŽç«¯å¢žåŠ å¯„å­˜å™¨ç™½åå•æ ¡éªŒï¼ˆä»…å…è®¸å†™å…¥å·²å®šä¹‰çš„ RW å¯„å­˜å™¨ï¼‰

### é£Žé™© 2: è½®è¯¢å¯¼è‡´æ€§èƒ½é—®é¢˜
**é£Žé™©ï¼š** å¤šç»„ä»¶åŒæ—¶è½®è¯¢å¯èƒ½å¯¼è‡´å¤§é‡è¯·æ±‚
**ç¼“è§£æŽªæ–½ï¼š**
- ä½¿ç”¨å…¨å±€çŠ¶æ€ç®¡ç†ï¼Œç»Ÿä¸€è½®è¯¢é€»è¾‘
- è°ƒæ•´è½®è¯¢é—´éš”ï¼ˆä»Ž 3 ç§’é™ä½Žåˆ° 5 ç§’ï¼‰
- é¡µé¢å¤±ç„¦æ—¶æš‚åœè½®è¯¢

### é£Žé™© 3: å“åº”å¼å¸ƒå±€çš„å¤æ‚åº¦
**æƒè¡¡ï¼š** ä¼˜å…ˆæ¡Œé¢ç«¯ä½“éªŒï¼Œç§»åŠ¨ç«¯æä¾›åŸºæœ¬å¯ç”¨æ€§
**å®žçŽ°ï¼š**
- ä½¿ç”¨ CSS Grid å¸ƒå±€ï¼Œè‡ªåŠ¨æ¢è¡Œ
- æ–­ç‚¹è®¾è®¡ï¼š>1200px ä¸‰åˆ—ï¼Œ768-1200px ä¸¤åˆ—ï¼Œ<768px å•åˆ—

### é£Žé™© 4: ç»„ä»¶æ‹†åˆ†è¿‡ç»†å¯¼è‡´ props drilling
**æƒè¡¡ï¼š** ä½¿ç”¨ Context API ä¼ é€’å…¨å±€æ•°æ®ï¼Œé¿å… props å±‚å±‚ä¼ é€’
**å®žçŽ°ï¼š** åˆ›å»º `HvacDataContext` å’Œ `ControlContext` åˆ†ç¦»æ•°æ®å’ŒæŽ§åˆ¶é€»è¾‘

## Migration Plan

**é˜¶æ®µ 1ï¼šåˆ›å»ºæ–°ç»„ä»¶ï¼ˆä¸å½±å“çŽ°æœ‰é¡µé¢ï¼‰**
1. åˆ›å»ºé€šç”¨ UI ç»„ä»¶ï¼ˆDataDisplay, ControlInput, ToggleSwitchï¼‰
2. åˆ›å»ºç³»ç»Ÿæ¦‚è§ˆåŒºåŸŸç»„ä»¶
3. åˆ›å»ºæˆ¿é—´ä¿¡æ¯åŒºåŸŸç»„ä»¶
4. åˆ›å»ºæ–°é£Žç³»ç»ŸåŒºåŸŸç»„ä»¶

**é˜¶æ®µ 2ï¼šé›†æˆåˆ°ä¸»é¡µé¢**
1. ä¿®æ”¹ `App.jsx`ï¼Œä½¿ç”¨æ–°å¸ƒå±€æ›¿æ¢ `RegistersPanel`
2. ä¿ç•™ `RegistersPanel` ä½œä¸ºè°ƒè¯•é¡µé¢ï¼ˆé€šè¿‡è·¯ç”±è®¿é—®ï¼‰

**é˜¶æ®µ 3ï¼šæ ·å¼ä¼˜åŒ–å’Œæµ‹è¯•**
1. è°ƒæ•´å“åº”å¼å¸ƒå±€
2. å®Œå–„äº¤äº’åé¦ˆ
3. æ‰‹åŠ¨æµ‹è¯•æŽ§åˆ¶æ“ä½œ

**å›žæ»šç­–ç•¥ï¼š**
- ä¿ç•™æ—§ç‰ˆ `RegistersPanel` ç»„ä»¶
- é€šè¿‡ feature flag æŽ§åˆ¶æ–°æ—§å¸ƒå±€åˆ‡æ¢

## Open Questions

- [ ] æ˜¯å¦éœ€è¦æ”¯æŒå¤šä¸ª Modbus è®¾å¤‡ï¼Ÿ
- [ ] è½®è¯¢é—´éš”å»ºè®®è®¾ç½®ä¸ºå¤šå°‘ï¼Ÿï¼ˆå½“å‰å»ºè®® 5 ç§’ï¼‰
- [ ] æ˜¯å¦éœ€è¦ç¦»çº¿æ¨¡å¼æ”¯æŒï¼ˆç½‘ç»œæ–­å¼€æ—¶é™çº§æ˜¾ç¤ºï¼‰ï¼Ÿ
- [ ] è¿è¡Œæ¨¡å¼çš„æžšä¸¾å€¼ï¼ˆ1:åˆ¶çƒ­ 2:åˆ¶å†· 3:é™¤æ¹¿ 4:é€šé£Žï¼‰æ˜¯å¦å‡†ç¡®ï¼Ÿ
