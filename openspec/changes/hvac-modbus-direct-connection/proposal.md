# HVAC Modbus 直连重构提案

## 动机

当前 HVAC Home Assistant 集成依赖一个独立运行的 FastAPI 后端服务，用户需要：
1. 启动后端服务
2. 确保后端持续运行
3. 在集成中配置后端地址

这种架构增加了部署复杂度，用户体验不佳。

## 目标

重构集成，使其直接通过 Modbus TCP 连接 HVAC 设备，无需独立后端：

- **简化部署**：用户只需安装集成，配置 Modbus 设备地址即可
- **降低维护成本**：无需管理独立后端服务
- **提高可靠性**：减少中间层，直接通信

## 范围

### 包含

- 将 pymodbus 客户端集成到 HA 组件
- 迁移寄存器定义到集成
- 重写数据协调器，直接读取 Modbus
- 更新配置流程，支持 Modbus 参数配置
- 更新所有实体的控制方法

### 不包含

- 后端服务的维护（保留供 Web 界面使用）
- 新功能添加
- 实体数量变更

## 成功标准

1. 集成可独立运行，无需后端服务
2. 所有现有实体功能正常（4 Climate, 18 Sensor, 4 Switch, 1 Select, 3 Number）
3. 配置流程支持 Modbus 参数（host, port, slave_id）
4. 在本地 Docker HA 环境测试通过

## 风险

| 风险 | 影响 | 缓解措施 |
|------|------|----------|
| pymodbus 异步兼容性 | 中 | 使用 AsyncModbusTcpClient |
| HA 沙箱网络限制 | 低 | 使用 host 网络模式 |
| 寄存器读取性能 | 低 | 批量读取，合理轮询间隔 |
